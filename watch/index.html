<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://pokemogukunns.github.io/keiryouka/css/pure-min.css">
  <link rel="stylesheet" href="https://pokemogukunns.github.io/keiryouka/css/grids-responsive-min.css">
  <link rel="stylesheet" href="https://pokemogukunns.github.io/keiryouka/css/ionicons.min.css">
  <link rel="stylesheet" href="https://pokemogukunns.github.io/keiryouka/css/default.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/main.js" async></script>
  <script src="/cache.js" async></script>
</head>
<body class="no-theme">
  <div class="pure-g"> 
    <div class="pure-u-1 pure-u-md-2-24"></div> 
    <div class="pure-u-1 pure-u-md-20-24" id="contents"> 
      <div class="pure-g navbar h-box"> 
        <div class="pure-u-1 pure-u-md-12-24 searchbar">
          <a href="./requestform">新機能の要望やバグ報告</a><br> 
          <a href="./bbs">掲示板</a>
          <form class="pure-form" action="/github-yuki/search/" method="get"> 
            <fieldset> 
              <input type="search" id="searchbox" autocomplete="on" autocorrect="on" autocapitalize="none" spellcheck="false" name="q" placeholder="検索" title="検索" value=""> 
            </fieldset> 
          </form> 
        </div> 
      </div> 
      <div id="player-container" class="h-box"> 
        <video style="outline:none;width:100%;background-color:#000;" id="player" controls>
          <source src="{% if proxy == 'True' %}/thumbnail?v={{ videoid }}{% else %}https://img.youtube.com/vi/{{ videoid }}/0.jpg{% endif %}">
        </video>
      </div> 
           <div class="h-box"> <h1>{{ videotitle }}</h1> </div> <div class="pure-g"> 
        <div class="pure-u-1 pure-u-lg-1-5"> 
          <a href="{{ videourls[0] }}" target="_blank">ダウンロード</a><br>
          <a href="javascript:{navigator.share({title: '動画を共有',text: '{{videotitle}}',url: location.protocol+'//'+document.domain+'/watch?v={{ videoid }}'+'&t='+Math.floor(document.getElementById('player').currentTime),})}">現時点の動画を共有</a><br>
          <a href="javascript:{navigator.share({title: '動画を共有',text: '{{videotitle}}',url: location.href,})}">動画を共有</a><br> 
          <hr> </div> <div class="pure-u-1 pure-u-lg-3-5">
            <div class="h-box">
            <a href="/github-yuki/channel#{{authorid}}" style="display:block;width:fit-content;width:-moz-fit-content">
              <div class="channel-profile">
                
                <img id="channelIcon" src="" alt="チャンネルアイコン" width="50" height="50" style="display:none;">
                
                <h2 id="channelName">{{ channelName }}</h2> </div> </a> 
            <div id="description-box"> <div id="descriptionWrapper">{{ description | safe}}</div> </div>
            <hr> <div id="comments"> </div> </div> </div> 
        <div class="pure-u-1 pure-u-lg-1-5">
          <!--自動再生<input type="checkbox" id="autonext" onchange="checkautoplay()"><br>-->
          ループ再生<input type="checkbox" id="loop" onchange="changeloop()"> {% for re in res %} <a href="/github-yuki/watch?v={{ re['id'] }}">
            <div class="thumbnail">
              <img loading="lazy" class="thumbnail" src="{% if proxy == "True" %}/thumbnail?v={{ re['id']}}{% else %}https://img.youtube.com/vi/{{ re['id'] }}/0.jpg{% endif %}">
            </div>
            <p style="width:100%">{{re["title"]}}</p> </a><br> 
          <a href="/github-yuki/channel#{{re['authorId']}}">{{re["author"]}}</a>{% endfor %} </div> </div> </div> </div> 
    </div>
    <div class="pure-u-1 pure-u-md-2-24"></div> 
  </div>
　<script>
        const apiKey = 'AIzaSyBU2xE_JHvB6wag3tMfhxXpg2Q_W8xnM-I'; // YouTube Data APIキーを入力

        // カスタムURLから動画IDを抽出する関数
        function extractVideoId(url) {
            const urlObj = new URL(url); // 入力されたURLを解析
            const videoId = urlObj.searchParams.get('v'); // "?v=動画ID" の部分を取得

            return videoId;
        }

        // YouTube APIを使って動画タイトルを取得する関数
        function getVideoTitleFromUrl() {
            const videoUrl = document.getElementById('videoUrl').value;
            const videoId = extractVideoId(videoUrl); // URLから動画IDを抽出

            if (!videoId) {
                alert("正しい動画のURLを入力してください！");
                return;
            }

            const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${apiKey}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.items.length > 0) {
                        const title = data.items[0].snippet.title;
                        document.getElementById('videotitle').innerText = title; // 動画タイトルを表示
                    } else {
                        document.getElementById('videotitle').innerText = "動画が見つかりませんでした";
                    }
                })
                .catch(error => {
                    console.error('Error fetching video title:', error);
                    document.getElementById('videotitle').innerText = "エラーが発生しました";
                });
        }
    </script>
  
  <script>
    $('#searchbox').autocomplete({
      source: function (request, response) {
        var url = "/suggest?keyword=" + encodeURIComponent(request.term);
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        xhr.onload = function() {
          if (xhr.status === 200) {
            response(JSON.parse(xhr.responseText));
          }
        };
        xhr.send();
      },
      delay: 300
    });
  </script>
</body>
</html>
